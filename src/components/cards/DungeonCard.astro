---
import { Image } from 'astro:assets';
import type { CollectionEntry } from 'astro:content';
import { difficultyLabels } from '../../utils/constants';

interface Props {
  dungeon: CollectionEntry<'donjons'>;
}

const { dungeon } = Astro.props;
const difficultyInfo = difficultyLabels[dungeon.data.difficulty] || difficultyLabels.medium;

// Add fallbacks for potentially missing image/icon data
const imageSrc = dungeon.data.image?.src ?? '/images/donjons/default-banner.jpg'; 
const imageAlt = dungeon.data.image?.alt ?? dungeon.data.name ?? 'Banni√®re par d√©faut';
const iconSrc = dungeon.data.icon?.src ?? '/images/donjons/default-icon.png';
const iconAlt = dungeon.data.icon?.alt ?? 'Ic√¥ne par d√©faut';

---

<a href={`/donjons/${dungeon.slug}`} class="group bg-white dark:bg-gray-800 rounded-xl overflow-hidden shadow-md hover:shadow-lg transition-all duration-300 relative flex flex-col h-full">
  <div class="relative">
    <Image
      src={imageSrc}
      alt={imageAlt}
      width={600}
      height={300}
      class="w-full h-48 object-cover"
    />
    <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-4">
      <h3 class="text-white text-xl font-bold truncate">{dungeon.data.name}</h3>
    </div>
    <div class={`absolute top-2 right-2 text-xs font-semibold px-2 py-1 rounded border ${difficultyInfo.color} border-opacity-50`}>
      {difficultyInfo.label}
    </div>
  </div>

  <div class="p-6 flex flex-col flex-grow">
    <div class="flex items-center mb-4">
      <div class={`bg-gray-500/20 dark:bg-gray-700/30 p-2 rounded-full mr-3 flex-shrink-0`}>
        <Image
          src={iconSrc}
          alt={iconAlt}
          width={32}
          height={32}
          class="w-8 h-8"
        />
      </div>
      <div class="flex flex-col min-w-0">
        <span class="text-gray-600 dark:text-gray-400 font-medium truncate">
          Niveau {dungeon.data.level}
        </span>
        <span class="text-gray-500 dark:text-gray-500 text-sm truncate">
          {dungeon.data.region}
        </span>
      </div>
    </div>

    <p class="text-gray-600 dark:text-gray-400 text-sm mb-4 line-clamp-3 flex-grow">
      {dungeon.data.description}
    </p>

    <div class="flex justify-between items-center mt-auto pt-4 border-t border-gray-200 dark:border-gray-700">
      <div class="flex items-center text-sm text-gray-600 dark:text-gray-400">
        {/* Placeholder for potential future info, e.g., player count */}
        {/* <span class="mr-1">üë•</span> {dungeon.data.players === 'solo' ? 'Solo' : dungeon.data.players === 'both' ? 'Solo/Groupe' : 'Groupe'} */}
      </div>
      <span class="text-wakfu-primary dark:text-wakfu-secondary font-medium text-sm group-hover:underline">
        Voir les d√©tails ‚Üí
      </span>
    </div>
  </div>
</a>