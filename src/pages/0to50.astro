---
// Supposons que vous ayez un Layout de base.
// Si ce n'est pas le cas, vous pouvez supprimer cette ligne et la balise <Layout>.
import Layout from "../layouts/layout.astro";

// D√©finissez ici la structure de vos paliers et missions.
// Vous devrez remplir cela avec vos propres donn√©es.
const tiersData = [
  {
    id: "palier1",
    nom: "Palier 1-10",
    descriptionNiveau: "Niveaux 1 √† 10",
    seuilXPNextPalier: 100, // Pourcentage pour passer au palier suivant
    missions: [
      {
      id: "m1-1",
      titre: "Tutoriel sur l'√Æle de Ri",
      image: "https://via.placeholder.com/150/FF6B35/FFFFFF?Text=IleRi",
      resumeCourt: "Compl√©tez le tutoriel complet sur l'√Æle de Ri.",
      resumeComplet:
        "Votre aventure commence sur l'√Æle myst√©rieuse de Ri ! Cette mission obligatoire vous fera d√©couvrir tous les m√©canismes de base de NexusWakfu. Apprenez √† vous d√©placer, √† attaquer, √† utiliser vos sorts et √† interagir avec l'environnement. Suivez attentivement les instructions du guide tutoriel, explorez chaque zone de l'√Æle et accomplissez toutes les t√¢ches demand√©es. Vous d√©couvrirez comment r√©colter des ressources, combattre vos premiers monstres et comprendre l'interface de jeu. √Ä la fin de ce tutoriel complet, vous atteindrez le niveau 6 et serez pr√™t √† rejoindre le continent principal. Cette √©tape est essentielle pour ma√Ætriser les bases avant de vous aventurer dans le vaste monde de NexusWakfu.",
      xp: 50,
      },
      {
      id: "m1-2",
      titre: "Qu√™te de P√©p√© Pale jusqu'au Prologue",
      image: "https://via.placeholder.com/150/4ECDC4/FFFFFF?Text=PepePale",
      resumeCourt: "Suivez P√©p√© Pale √† Astrub jusqu'au Prologue.",
      resumeComplet:
        "Une fois arriv√© √† Astrub depuis l'√Æle de Ri, votre premi√®re priorit√© est de retrouver le myst√©rieux P√©p√© Pale. Ce personnage embl√©matique vous guidera √† travers une s√©rie de qu√™tes captivantes qui vous feront d√©couvrir la ville d'Astrub et ses environs. Explorez les diff√©rents quartiers, rencontrez les habitants locaux et accomplissez les t√¢ches que P√©p√© Pale vous confie. Cette cha√Æne de qu√™tes vous m√®nera progressivement vers le Prologue, une √©tape cruciale de votre parcours. Vous apprendrez les sp√©cificit√©s de votre classe, d√©couvrirez l'histoire du monde et d√©velopperez vos premi√®res strat√©gies de combat. En compl√©tant cette s√©rie de qu√™tes obligatoires, vous atteindrez le niveau 10 et serez officiellement initi√© aux myst√®res de NexusWakfu.",
      xp: 50,
      },
    ],
  },
  {
    id: "palier2", // ID corrig√© pour √™tre unique
    nom: "Palier 11-20", // Nom ajust√© pour refl√©ter un nouveau palier
    descriptionNiveau: "Niveaux 11 √† 20",
    seuilXPNextPalier: 90,
    missions: [
      {
        id: "m2-1",
        titre: "D√©couverte des qu√™tes environnementales d'Astrub",
        image: "https://via.placeholder.com/150/32CD32/FFFFFF?Text=QuestesEnviro",
        resumeCourt: "Explorez les qu√™tes environnementales pour obtenir des Sioupi√®res Glou.",
        resumeComplet:
          "Partez √† la d√©couverte des diff√©rentes zones environnementales d'Astrub ! Ces qu√™tes sp√©ciales vous permettront de r√©colter des Sioupi√®res Glou, des objets de valeur tr√®s recherch√©s par les joueurs exp√©riment√©s. Explorez les plaines, les for√™ts et les zones mar√©cageuses autour d'Astrub. Chaque environnement propose des d√©fis uniques et des r√©compenses sp√©cifiques. Les Sioupi√®res Glou que vous obtiendrez peuvent √™tre vendues √† bon prix sur le march√©, vous permettant de financer vos futurs √©quipements. Cette activit√© vous familiarisera √©galement avec l'√©cosyst√®me complexe de NexusWakfu et l'importance de la pr√©servation environnementale dans le jeu.",
        xp: 40,
      },
      {
        id: "m2-2",
        titre: "D√©couverte des m√©tiers de r√©colte",
        image: "https://via.placeholder.com/150/8B4513/FFFFFF?Text=Recolte",
        resumeCourt: "Initiez-vous aux m√©tiers de r√©colte pour devenir autonome.",
        resumeComplet:
          "Il est temps d'apprendre les m√©tiers de base qui vous rendront autonome dans NexusWakfu ! Dirigez-vous vers les diff√©rentes zones de r√©colte autour d'Astrub et initiez-vous aux m√©tiers fondamentaux : B√ªcheron pour couper du bois, Mineur pour extraire des minerais, Paysan pour cultiver des c√©r√©ales, et P√™cheur pour attraper des poissons. Chaque m√©tier a ses propres outils et techniques. Commencez par r√©colter des ressources de niveau 1 √† 20 pour vous familiariser avec les m√©caniques. Ces ressources vous serviront plus tard pour l'artisanat et vous permettront de g√©n√©rer des revenus r√©guliers. Prenez le temps de comprendre les cycles de repousse des ressources et les meilleures zones de r√©colte.",
        xp: 20,
      },
      {
        id: "m2-3",
        titre: "Chasse aux groupes de Bouftout",
        image: "https://via.placeholder.com/150/FF6347/FFFFFF?Text=Bouftout",
        resumeCourt: "Chassez des petits groupes de Bouftout pour vous √©quiper.",
        resumeComplet:
          "Les Bouftout sont d'excellentes cr√©atures pour s'entra√Æner au combat en groupe et obtenir des √©quipements de qualit√© ! Formez des groupes de 2 √† 4 joueurs et partez chasser ces cr√©atures dans les plaines d'Astrub. Les Bouftout se d√©placent souvent en petits troupeaux, ce qui vous permettra de vous exercer aux tactiques de groupe et √† la coordination. Leurs drops incluent de la laine pr√©cieuse, de la viande nutritive et parfois des √©quipements utiles pour votre niveau. Variez vos cibles entre Bouftout Blanc, Bouftout Noir et Bouftout Sauvage pour d√©couvrir leurs diff√©rentes r√©compenses. Cette chasse vous pr√©parera aux d√©fis plus importants qui vous attendent.",
        xp: 30,
      },
      {
        id: "m2-4",
        titre: "Donjon du Bouftout Royal en Stasis 1",
        image: "https://via.placeholder.com/150/DAA520/FFFFFF?Text=BouftoutRoyal",
        resumeCourt: "Affrontez le Bouftout Royal dans son donjon en difficult√© Stasis 1.",
        resumeComplet:
          "Le moment est venu d'affronter votre premier v√©ritable d√©fi : le Donjon du Bouftout Royal en Stasis 1 ! Ce donjon embl√©matique d'Astrub vous confrontera au majestueux Bouftout Royal et √† sa garde rapproch√©e. Formez une √©quipe √©quilibr√©e de 3 √† 6 joueurs avec diff√©rentes classes pour maximiser vos chances de succ√®s. Le Bouftout Royal poss√®de des attaques puissantes et des sorts de zone, vous devrez donc coordonner vos actions et utiliser des strat√©gies de positionnement. La difficult√© Stasis 1 est parfaite pour votre niveau et vous r√©compensera avec des √©quipements de qualit√© sup√©rieure, des kamas et de l'exp√©rience pr√©cieuse. N'oubliez pas d'apporter des potions de soin et de pr√©parer vos sorts avant le combat !",
        xp: 10,
      },
    ],
  },
  // Ajoutez d'autres paliers jusqu'au niveau 50.
  {
    id: "palier3", // Ajout d'un palier interm√©diaire pour tester la progression
    nom: "Palier 21-30",
    descriptionNiveau: "Niveaux 21 √† 30",
    seuilXPNextPalier: 80,
    missions: [
      {
      id: "m3-1",
      titre: "Qu√™tes de Nation - Chapitre 1",
      image: "https://via.placeholder.com/150/9932CC/FFFFFF?Text=Nation1",
      resumeCourt: "Commencez votre parcours citoyen en rejoignant une nation.",
      resumeComplet:
        "Il est temps de choisir votre camp et de devenir citoyen d'une des grandes nations de NexusWakfu ! Rendez-vous dans les capitales (Bonta, Br√¢kmar ou Sufokia) et entamez les qu√™tes de citoyennet√©. Ces missions vous feront d√©couvrir l'histoire, les valeurs et les traditions de votre nation choisie. Vous devrez prouver votre loyaut√© en accomplissant diverses t√¢ches : aider les citoyens locaux, d√©fendre les int√©r√™ts de votre nation et participer aux activit√©s communautaires. Le Chapitre 1 vous initiera aux m√©caniques politiques et vous donnera acc√®s aux premiers avantages citoyens, notamment l'acc√®s aux zones r√©serv√©es et aux qu√™tes sp√©ciales de votre nation.",
      xp: 40,
      },
      {
      id: "m3-2",
      titre: "Qu√™tes de Nation - Chapitre 2",
      image: "https://via.placeholder.com/150/DC143C/FFFFFF?Text=Nation2",
      resumeCourt: "Approfondissez votre engagement citoyen et grimpez en grade.",
      resumeComplet:
        "Poursuivez votre ascension dans la hi√©rarchie de votre nation en compl√©tant le Chapitre 2 des qu√™tes nationales ! Ces missions plus complexes vous demanderont de participer activement √† la vie politique et militaire de votre nation. Vous devrez peut-√™tre mener des missions d'espionnage, participer √† des batailles contre les nations rivales, ou n√©gocier des alliances diplomatiques. Ce chapitre vous r√©v√©lera des secrets d'√âtat et vous donnera acc√®s √† des √©quipements et sorts exclusifs √† votre nation. Votre grade citoyen augmentera, vous offrant plus de privil√®ges et de responsabilit√©s au sein de votre communaut√© nationale.",
      xp: 40,
      },
      {
      id: "m3-3",
      titre: "D√©couverte d'Amakna",
      image: "https://via.placeholder.com/150/228B22/FFFFFF?Text=Amakna",
      resumeCourt: "Explorez le continent sauvage d'Amakna et ses myst√®res.",
      resumeComplet:
        "Partez √† la d√©couverte d'Amakna, le continent principal de NexusWakfu ! Cette vaste terre regorge de biomes vari√©s, de cr√©atures fascinantes et de tr√©sors cach√©s. Explorez les for√™ts enchant√©es, les plaines verdoyantes, les mar√©cages myst√©rieux et les montagnes escarp√©es. Chaque r√©gion d'Amakna a ses propres sp√©cificit√©s : ressources uniques, monstres particuliers et qu√™tes locales. D√©couvrez les villages pittoresques comme Kelba, les donjons l√©gendaires et les zones de ressources de haut niveau. Cette exploration vous permettra de cartographier le continent, de d√©bloquer de nouveaux zaaps (points de t√©l√©portation) et de vous familiariser avec la g√©ographie complexe qui sera cruciale pour vos futures aventures.",
      xp: 20,
      },
    ],
  },
  {
    id: "palier4", // Ajout d'un palier interm√©diaire pour tester la progression
    nom: "Palier 31-40",
    descriptionNiveau: "Niveaux 31 √† 40",
    seuilXPNextPalier: 90,
    missions: [
      {
      id: "m4-1",
      titre: "Qu√™tes de Nation - Chapitre 3 Bonta",
      image: "https://via.placeholder.com/150/4169E1/FFFFFF?Text=BontaCh3",
      resumeCourt: "Poursuivez votre parcours citoyen √† Bonta avec le Chapitre 3.",
      resumeComplet:
        "Continuez votre ascension dans la hi√©rarchie de Bonta en compl√©tant le Chapitre 3 des qu√™tes nationales. Ces missions avanc√©es vous plongeront au c≈ìur des intrigues politiques de la cit√© blanche. Vous devrez peut-√™tre infiltrer des r√©seaux d'espions, prot√©ger des dignitaires ou mener des op√©rations diplomatiques d√©licates. Ce chapitre r√©v√®le les secrets les mieux gard√©s de Bonta et vous pr√©pare aux responsabilit√©s de haut rang. Votre loyaut√© sera mise √† l'√©preuve et vos d√©cisions auront un impact sur l'avenir de la nation. En r√©compense, vous d√©bloquerez des √©quipements exclusifs et des sorts puissants r√©serv√©s aux citoyens d'√©lite de Bonta.",
      xp: 30,
      },
      {
      id: "m4-2",
      titre: "Qu√™tes de Nation - Chapitre 4 Br√¢kmar",
      image: "https://via.placeholder.com/150/8B0000/FFFFFF?Text=BrakmarCh4",
      resumeCourt: "Explorez les myst√®res sombres de Br√¢kmar au Chapitre 4.",
      resumeComplet:
        "Plongez dans les profondeurs de Br√¢kmar et d√©couvrez les secrets les plus sombres de cette nation myst√©rieuse. Le Chapitre 4 vous confrontera aux aspects les plus dangereux de la politique br√¢kmarienne : complots d'assassinat, magie interdite et alliances occultes. Vous devrez naviguer dans un monde d'ombres et de trahisons o√π chaque d√©cision peut √™tre fatale. Ces missions vous donneront acc√®s aux techniques de combat les plus redoutables et aux sorts les plus puissants de Br√¢kmar. Votre rang dans la hi√©rarchie br√¢kmarienne atteindra des sommets, vous octroyant des privil√®ges exceptionnels et l'acc√®s aux zones les plus secr√®tes de la cit√© noire.",
      xp: 30,
      },
      {
      id: "m4-3",
      titre: "Optimisation d'√©quipement : Moogr et Craqueleur",
      image: "https://via.placeholder.com/150/FF8C00/FFFFFF?Text=Equipment",
      resumeCourt: "√âquipez-vous selon votre style de combat : Moogr pour la distance, Craqueleur pour le m√©l√©e.",
      resumeComplet:
        "Il est temps d'optimiser votre √©quipement selon votre style de jeu ! Pour les combattants √† distance, concentrez-vous sur l'ensemble Moogr qui offre d'excellents bonus de port√©e et de dommages √† distance. Recherchez les bottes, la coiffe et la cape Moogr qui am√©liorent significativement vos capacit√©s de frappe √† longue port√©e. Pour les guerriers de m√©l√©e, l'√©quipement Craqueleur est id√©al avec ses bonus de r√©sistance et de dommages au corps √† corps. Farmez les diff√©rentes pi√®ces de ces sets en chassant les monstres appropri√©s ou en les achetant √† l'h√¥tel de vente. Un bon √©quipement adapt√© √† votre classe fera toute la diff√©rence dans les combats √† venir !",
      xp: 10,
      },
      {
      id: "m4-4",
      titre: "Donjon de la Mort Br√ªl√©e en Stasis 3",
      image: "https://via.placeholder.com/150/DC143C/FFFFFF?Text=MortBrulee",
      resumeCourt: "Affrontez le donjon de la Mort Br√ªl√©e en groupe pour farmer les Bottes de Koko et esp√©rer le drop de Kyou Aile.",
      resumeComplet:
        "Pr√©parez-vous pour l'un des d√©fis les plus intenses de votre parcours : le Donjon de la Mort Br√ªl√©e en difficult√© Stasis 3 ! Ce donjon redoutable demande une √©quipe exp√©riment√©e de 4 √† 6 joueurs parfaitement coordonn√©s. Votre objectif principal est de farmer les pr√©cieuses Bottes de Koko, un √©quipement tr√®s recherch√© pour leurs excellentes statistiques. Mais le v√©ritable tr√©sor serait de voir appara√Ætre la l√©gendaire Kyou Aile, un drop extr√™mement rare qui fera de vous l'envie de tous les joueurs. La difficult√© Stasis 3 augmente consid√©rablement les statistiques des monstres, mais aussi les chances de drops rares. Pr√©parez vos meilleures strat√©gies, vos potions les plus puissantes et armez-vous de patience pour ce farm intensif !",
      xp: 30,
      },
    ],
  },
  {
    id: "palierFinal",
    nom: "Palier 41-50",
    descriptionNiveau: "Niveaux 41 √† 50",
    seuilXPNextPalier: 100,
    missions: [
      {
      id: "mf-1",
      titre: "Qu√™tes de Nation - Chapitre Final Sufokia",
      image: "https://via.placeholder.com/150/FF8C00/FFFFFF?Text=SufokiaFinal",
      resumeCourt: "Compl√©tez le dernier chapitre des qu√™tes nationales de Sufokia.",
      resumeComplet:
        "Terminez votre parcours citoyen de Sufokia avec le chapitre final de cette nation maritime. Plongez dans les myst√®res des profondeurs oc√©aniques et d√©couvrez les secrets ancestraux des Sufokiens. Vous devrez naviguer entre les intrigues des marchands, les l√©gendes des pirates et les myst√®res des cr√©atures des abysses. Ce chapitre final vous r√©v√©lera l'histoire cach√©e de Sufokia et vous donnera acc√®s aux plus grands tr√©sors de cette nation aquatique. Votre rang de citoyen atteindra son apog√©e, vous octroyant des privil√®ges uniques et l'acc√®s aux zones les plus secr√®tes des cit√©s sous-marines sufokiennes.",
      xp: 100,
      },
    ],
  },
];
---

<Layout title="Guide de Progression NexusWakfu">
  <div class="guide-nexuswakfu">
    <h1>Guide de Progression Interactif</h1>
    <div style="text-align: center; margin-bottom: 20px;">
      <a href="/" class="btn-accueil">‚Üê Retour √† l'accueil</a>
    </div>
    <div id="paliers-container">
      <!-- Les paliers seront inject√©s ici par JavaScript -->
    </div>

    <div
      id="message-felicitations"
      class="hidden"
      style="text-align: center; margin-top: 30px; padding: 25px; background-color: #e6ffed; border: 2px solid #34d399; border-radius: 8px; color: #065f46;"
    >
      <h2>üéâ F√©licitations ! üéâ</h2>
      <p>
        Vous avez brillamment compl√©t√© tous les paliers du guide ! Vous √™tes un
        v√©ritable expert de NexusWakfu !
      </p>
    </div>
  </div>

  <script define:vars={{ tiersData }}>
    const paliersContainer = document.getElementById("paliers-container");
    const messageFelicitations = document.getElementById(
      "message-felicitations"
    );
    let palierActuelIndex = 0;
    let elementsPaliersDom = []; // Pour stocker les √©l√©ments DOM des paliers
    let passageEnCours = false; // Variable pour suivre si un passage est en cours
    let timerPassage = null; // Pour stocker l'ID du timer de passage

    function creerCarteMission(mission, callbackValidation) {
      const carte = document.createElement("div");
      carte.className = "mission-carte";
      carte.dataset.missionId = mission.id;

      const img = document.createElement("img");
      img.src = mission.image;
      img.alt = mission.titre;
      carte.appendChild(img);

      const titre = document.createElement("h3");
      titre.textContent = mission.titre;
      carte.appendChild(titre);

      const resumeCourtEl = document.createElement("p");
      resumeCourtEl.className = "resume-court";
      resumeCourtEl.textContent = mission.resumeCourt;
      carte.appendChild(resumeCourtEl);

      const resumeCompletEl = document.createElement("p");
      resumeCompletEl.className = "resume-complet hidden";
      // Assurez-vous que mission.resumeComplet contient suffisamment de texte.
      resumeCompletEl.textContent = mission.resumeComplet;
      carte.appendChild(resumeCompletEl);

      const btnVoirPlus = document.createElement("button");
      btnVoirPlus.className = "btn-voir-plus";
      btnVoirPlus.textContent = "Voir plus";
      btnVoirPlus.onclick = () => {
        resumeCourtEl.classList.toggle("hidden");
        resumeCompletEl.classList.toggle("hidden");
        btnVoirPlus.textContent = resumeCompletEl.classList.contains("hidden")
          ? "Voir plus"
          : "Voir moins";
      };
      carte.appendChild(btnVoirPlus);

      const btnValider = document.createElement("button");
      btnValider.className = "btn-valider";
      btnValider.textContent = "Valider";
      btnValider.onclick = () => {
        if (!carte.classList.contains("validee")) {
          carte.classList.add("validee");
          btnValider.textContent = "Valid√©e ‚úî";
          btnValider.disabled = true;
          btnVoirPlus.disabled = true; // Optionnel: d√©sactiver aussi voir plus
          callbackValidation(mission.xp);
        }
      };
      carte.appendChild(btnValider);

      return carte;
    }

    function afficherPalier(index) {
      // V√©rifier si l'index est valide
      if (index < 0 || index > tiersData.length) {
        console.error("Index de palier invalide:", index);
        return;
      }

      // R√©initialiser l'√©tat de passage
      passageEnCours = false;
      if (timerPassage) {
        clearTimeout(timerPassage);
        timerPassage = null;
      }

      // Cacher tous les paliers pr√©c√©demment affich√©s
      elementsPaliersDom.forEach((element) => {
        if (element) {
          element.style.display = "none";
        }
      });

      // Si le palier actuel a d√©j√† √©t√© rendu, le montrer et sortir
      if (elementsPaliersDom[index]) {
        elementsPaliersDom[index].style.display = "block";
        return;
      }

      if (index >= tiersData.length) {
        // Tous les paliers sont compl√©t√©s
        messageFelicitations.classList.remove("hidden");
        return;
      }

      const palierData = tiersData[index];
      const divPalier = document.createElement("div");
      divPalier.className = "palier";
      divPalier.dataset.palierId = palierData.id;
      elementsPaliersDom[index] = divPalier;

      // Ajouter un en-t√™te avec le num√©ro du palier pour faciliter le d√©bogage
      const debugInfo = document.createElement("div");
      debugInfo.className = "debug-info";
      debugInfo.textContent = `Palier actuel: ${index + 1} sur ${tiersData.length}`;
      debugInfo.style.fontSize = "0.8em";
      debugInfo.style.color = "#888";
      debugInfo.style.marginBottom = "5px";
      divPalier.appendChild(debugInfo);

      const titrePalier = document.createElement("h2");
      titrePalier.textContent = `${palierData.nom} (${palierData.descriptionNiveau})`;
      divPalier.appendChild(titrePalier);

      const barreProgressionContainer = document.createElement("div");
      barreProgressionContainer.className = "barre-progression-container";
      const barreProgression = document.createElement("div");
      barreProgression.className = "barre-progression";
      barreProgression.style.width = "0%";
      barreProgressionContainer.appendChild(barreProgression);
      divPalier.appendChild(barreProgressionContainer);

      const texteProgression = document.createElement("p");
      texteProgression.className = "texte-progression";
      texteProgression.textContent = "Progression: 0%";
      divPalier.appendChild(texteProgression);

      const missionsContainer = document.createElement("div");
      missionsContainer.className = "missions-grille";
      divPalier.appendChild(missionsContainer);

      let xpAccumule = 0;
      const xpTotalPalier = palierData.missions.reduce(
        (total, m) => total + m.xp,
        0
      );

      palierData.missions.forEach((mission) => {
        const carteMission = creerCarteMission(mission, (xpGagnee) => {
          xpAccumule += xpGagnee;
          const pourcentage =
            xpTotalPalier > 0
              ? Math.min(100, (xpAccumule / xpTotalPalier) * 100)
              : 0;
          barreProgression.style.width = `${pourcentage}%`;
          texteProgression.textContent = `Progression: ${Math.round(pourcentage)}%`;

          // V√©rifier si la progression est suffisante pour d√©bloquer le prochain palier
          // et s'assurer qu'un passage n'est pas d√©j√† programm√©
          if (pourcentage >= palierData.seuilXPNextPalier && !passageEnCours) {
            // Marquer qu'un passage est en cours
            passageEnCours = true;

            // Supprimer tout ancien message de d√©blocage
            const ancienMessage = divPalier.querySelector(".message-deblocage");
            if (ancienMessage) {
              divPalier.removeChild(ancienMessage);
            }

            // Afficher un message pour informer l'utilisateur
            const msgDeblocage = document.createElement("div");
            msgDeblocage.className = "message-deblocage";
            msgDeblocage.textContent = `Vous avez d√©bloqu√© le palier suivant ! Chargement dans 3 secondes...`;
            msgDeblocage.style.color = "var(--couleur-succes)";
            msgDeblocage.style.fontWeight = "bold";
            msgDeblocage.style.marginTop = "10px";
            msgDeblocage.style.textAlign = "center";

            divPalier.appendChild(msgDeblocage);

            // Annuler tout timer pr√©c√©dent
            if (timerPassage) {
              clearTimeout(timerPassage);
            }

            // Cr√©er un nouveau timer
            timerPassage = setTimeout(() => {
              // V√©rifier que nous sommes toujours sur le m√™me palier
              if (palierActuelIndex === index) {
                passerAuPalierSuivant();
              }
            }, 3000);
          }
        });
        missionsContainer.appendChild(carteMission);
      });

      paliersContainer.appendChild(divPalier);

      // Log de d√©bogage
      console.log(
        `Palier ${index + 1}/${tiersData.length} affich√©: ${palierData.nom}`
      );
    }

    function passerAuPalierSuivant() {
      // R√©initialiser les variables de contr√¥le
      passageEnCours = false;
      if (timerPassage) {
        clearTimeout(timerPassage);
        timerPassage = null;
      }

      // S'assurer qu'on ne d√©passe pas le nombre de paliers disponibles
      if (palierActuelIndex < tiersData.length - 1) {
        console.log(
          `Passage du palier ${palierActuelIndex + 1} au palier ${palierActuelIndex + 2}`
        );
        palierActuelIndex++;
        afficherPalier(palierActuelIndex);
      } else {
        // Si c'est le dernier palier, afficher le message de f√©licitations
        console.log("Dernier palier compl√©t√©, affichage des f√©licitations");
        messageFelicitations.classList.remove("hidden");
        // Cacher le dernier palier
        if (elementsPaliersDom[palierActuelIndex]) {
          elementsPaliersDom[palierActuelIndex].style.display = "none";
        }
      }
    }

    // Affichage initial du premier palier
    afficherPalier(palierActuelIndex);
  </script>

  <style is:global>
    :root {
      --couleur-principale: #4a90e2; /* Bleu Nexus */
      --couleur-succes: #50e3c2; /* Vert menthe succ√®s */
      --couleur-texte: #333;
      --couleur-fond-carte: #ffffff;
      --couleur-fond-page: #f4f7f6;
      --ombre-carte: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      background-color: var(--couleur-fond-page);
      color: var(--couleur-texte);
      line-height: 1.6;
    }

    .guide-nexuswakfu {
      max-width: 1000px;
      margin: 20px auto;
      padding: 20px;
      background-color: var(--couleur-fond-carte);
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.05);
    }

    .guide-nexuswakfu h1 {
      text-align: center;
      color: var(--couleur-principale);
      margin-bottom: 30px;
    }

    .palier {
      margin-bottom: 40px;
      padding: 20px;
      background-color: #fff;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      box-shadow: var(--ombre-carte);
    }

    .palier h2 {
      color: var(--couleur-principale);
      border-bottom: 2px solid var(--couleur-principale);
      padding-bottom: 10px;
      margin-top: 0;
    }

    .barre-progression-container {
      width: 100%;
      background-color: #e0e0e0;
      border-radius: 25px;
      margin: 15px 0;
      height: 25px;
      overflow: hidden;
    }

    .barre-progression {
      height: 100%;
      width: 0%;
      background-color: var(--couleur-succes);
      border-radius: 25px;
      transition: width 0.6s ease-in-out;
      text-align: center;
      color: white;
      font-weight: bold;
      line-height: 25px; /* Pour centrer le texte si on en met */
    }

    .texte-progression {
      text-align: right;
      font-size: 0.9em;
      color: #555;
      margin-top: 5px;
    }

    .missions-grille {
      display: grid;
      /* Augmentation de la largeur minimale pour que les cartes prennent plus de place */
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    /* Pour les √©crans larges, nous visons moins de cartes par ligne pour qu'elles soient plus larges. */
    @media (min-width: 992px) {
      /* S'aligne sur la largeur max du conteneur .guide-nexuswakfu */
      .missions-grille {
        /* R√©duction du nombre de colonnes pour des cartes plus larges */
        grid-template-columns: repeat(3, 1fr);
      }
    }

    .mission-carte {
      background-color: var(--couleur-fond-carte);
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      box-shadow: var(--ombre-carte);
      transition:
        transform 0.2s ease-out,
        box-shadow 0.2s ease-out;
      display: flex;
      flex-direction: column;
    }

    .mission-carte:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
    }

    .mission-carte.validee {
      background-color: #f0fff4; /* Vert tr√®s clair */
      opacity: 0.75;
      border-left: 5px solid var(--couleur-succes);
    }

    .mission-carte.validee:hover {
      transform: none;
      box-shadow: var(--ombre-carte);
    }

    .mission-carte img {
      width: 100%;
      height: 120px; /* Ajust√© l√©g√®rement pour des cartes plus petites */
      object-fit: cover;
      border-radius: 6px;
      margin-bottom: 10px;
    }

    .mission-carte h3 {
      margin-top: 0;
      margin-bottom: 8px;
      font-size: 1.1em; /* L√©g√®rement r√©duit pour cartes plus petites */
      color: #333;
    }

    .mission-carte p {
      font-size: 0.9em; /* L√©g√®rement r√©duit */
      margin-bottom: 12px;
      flex-grow: 1;
    }
    .mission-carte .resume-complet {
      font-size: 0.85em; /* L√©g√®rement r√©duit */
      color: #555;
    }

    .mission-carte button {
      padding: 8px 12px; /* Ajust√© pour des cartes plus petites */
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.2s ease;
      margin-top: 5px;
    }

    .mission-carte .btn-voir-plus {
      background-color: #e0e0e0;
      color: #333;
      margin-right: 5px; /* Ajustement pour espacement si les boutons sont sur la m√™me ligne */
    }
    .mission-carte .btn-voir-plus:hover {
      background-color: #c7c7c7;
    }

    .mission-carte .btn-valider {
      background-color: var(--couleur-principale);
      color: white;
    }
    .mission-carte .btn-valider:hover {
      background-color: #3a7bc8;
    }
    .mission-carte .btn-valider:disabled {
      background-color: var(--couleur-succes);
      color: #065f46;
      cursor: not-allowed;
    }
    .mission-carte .btn-valider:disabled:hover {
      background-color: var(--couleur-succes);
    }

    .hidden {
      display: none !important;
    }

    /* Style pour le message de d√©blocage */
    .message-deblocage {
      padding: 10px;
      background-color: rgba(80, 227, 194, 0.1);
      border-radius: 5px;
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0% {
        opacity: 0.6;
      }
      50% {
        opacity: 1;
      }
      100% {
        opacity: 0.6;
      }
    }

    /* Style pour l'info de d√©bogage */
    .debug-info {
      background-color: #f5f5f5;
      padding: 5px;
      border-radius: 3px;
      margin-bottom: 10px;
    }
  </style>
</Layout>
